var FormCheck=new Class({Implements:[Options,Events],options:{tipsClass:"fc-tbx",errorClass:"fc-error",fieldErrorClass:"fc-field-error",submit:true,submitAction:false,submitMethod:false,trimValue:false,validateDisabled:false,ajaxSubmit:false,ajaxOptions:{},onSubmit:$empty,onValidateSuccess:$empty,onValidateFailure:$empty,validate:{},display:{showErrors:0,titlesInsteadNames:0,errorsLocation:1,indicateErrors:1,indicateErrorsInit:0,keepFocusOnError:0,checkValueIfEmpty:1,addClassErrorToField:0,removeClassErrorOnTipClosure:0,replaceTipsEffect:1,flashTips:0,closeTipsButton:1,tipsPosition:"right",tipsOffsetX:-45,tipsOffsetY:0,listErrorsAtTop:false,scrollToFirst:true,fadeDuration:300},alerts:{required:"This field is required.",alpha:"This field accepts alphabetic characters only.",alphanum:"This field accepts alphanumeric characters only.",nodigit:"No digits are accepted.",digit:"Please enter a valid integer.",digitltd:"The value must be between %0 and %1",number:"Please enter a valid number.",email:"Please enter a valid email.",image:"This field should only contain image types",phone:"Please enter a valid phone.",phone2:"Please enter a valid phone.",phone3:"Please enter a valid phone.",phone_inter:"Please enter a valid international phone number.",url:"Please enter a valid url.",confirm:"This field is different from %0",differs:"This value must be different of %0",length_str:"The length is incorrect, it must be between %0 and %1",length_fix:"The length is incorrect, it must be exactly %0 characters",lengthmax:"The length is incorrect, it must be at max %0",lengthmin:"The length is incorrect, it must be at least %0",words_min:"This field must concain at least %0 words, currently: %1 words",words_range:"This field must contain %0-%1 words, currently: %2 words",words_max:"This field must contain at max %0 words, currently: %1 words",checkbox:"Please check the box",checkboxes_group:"Please check at least %0 box(es)",radios:"Please select a radio",select:"Please choose a value",select_multiple:"Please choose at least one value",date:"Please enter a valid date"},regexp:{required:/[^.*]/,alpha:/^[a-z ._-]+$/i,alphanum:/^[a-z0-9 ._-]+$/i,digit:/^[-+]?[0-9]+$/,nodigit:/^[^0-9]+$/,number:/^[-+]?\d*\.?\d+$/,email:/^([a-zA-Z0-9_\.\-\+%])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,image:/.(jpg|jpeg|png|gif|bmp)$/i,phone:/^\+{0,1}[0-9 \(\)\.\-]+$/,phone2:/^[\d\s ().-]+$/,phone3:/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/,phone_inter:/^\+{0,1}[0-9 \(\)\.\-]+$/,url:/^(http|https|ftp)\:\/\/[a-z0-9\-\.]+\.[a-z]{2,3}(:[a-z0-9]*)?\/?([a-z0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])*$/i,date:/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{2,4}$/}},initialize:function(d,b){if((this.form=$(d))){var a=this;a.form.isValid=true;a.regex=["length"];a.groups={};a.setOptions(b);var c=a.options;this.UI=(FormCheck.UI)&&new FormCheck.UI(this,this.options);if(typeof(formcheckLanguage)!="undefined"){this.options.alerts=$merge(this.options.alerts,formcheckLanguage)}this.Locale=(FormCheck.Locale&&typeof(formcheckLanguage)=="undefined")?new FormCheck.Locale(this,this.options):this.options;a.form.setProperty("action",c.submitAction||a.form.getProperty("action")||"");a.form.setProperty("method",c.submitMethod||a.form.getProperty("method")||"post");a.validations=[];a.alreadyIndicated=false;a.firstError=false;$H(c.regexp).each(function(e,f){a.regex.push(f)});a.addValidator(a.options.validate,false);a.form.getElements("*[class*=validate]").each(function(e){a.register(e)});a.form.addEvents({submit:a.onSubmit.bind(a)});if(a.options.display.indicateErrorsInit){a.validations.each(function(e){if(!a.manageError(e,"submit")){a.form.isValid=false}})}}},cpuValidator:function(b,e,k){if(typeof(e)=="string"){e=e.split(/,(?!\s*-*\d])/)}if(typeof(e)=="object"){for(var a="",f=0,c=e.length,m=e;f<c;f++){var g=(c-1>f)?"',":"'";a+="'"+m[f].replace(" ","")+g}e=a}if(e){var h="validate["+e+"]";var j=b.getProperty("class").replace(/\s?validate(\[.+\])/,"");b.setProperty("class",j);b.addClass(h);if(k){k=typeof(k)=="number"?k:false;this.register(b,k)}}},addValidator:function(c,b){var a=this;$each(c,function(d,e){if($chk($(e))){e=$(e);a.cpuValidator(e,d,b)}else{if($chk($$(e))){$$(e).each(function(f){a.cpuValidator(f,d,b)})}}})},register:function(el,position){var own=this,validators;el.validation=[];if(!(validators=eval(el.getProperty("class").match(/validate(\[.+\])/)[1]))){return}var valid=true;validators.each(function(v){el.validation.push(v);if(v.match(/^confirm:/)){var field=v.match(/.+:(.+)$/)[1];if(own.form[field].validation.contains("required")){el.validation.push("required")}}if(v.match(/^target:.+/)){el.target=v.match(/^target:(.+)/)[1]}});el.isChild=own.isChildType(el,validators);if(el.isChild&&el.type=="radio"){own.validations.each(function(registeredEl){if(registeredEl.name==el.name){valid=false}})}if(el.isChild&&el.type=="checkbox"){own.validations.each(function(registeredEl){if(registeredEl.groupID==el.groupID){valid=false}})}if(position&&position<=own.validations.length){var newValidations=[];own.validations.each(function(valider,i){if(position==i+1&&valid){newValidations.push(el);own.addListener(el)}newValidations.push(valider)});own.validations=newValidations}else{if(valid){own.validations.push(el);own.addListener(el)}}},dispose:function(a){this.validations.erase(a)},checkChild:function(c){var a=this,d=a.options;if(!c.isChild){c.addEvent("blur",function(){if(!a.fxRunning&&(c.element||d.display.showErrors==1)&&(d.display.checkValueIfEmpty||c.value)){a.manageError(c,"blur")}})}else{if(c.isChild&&c.type=="radio"){var b=a.form.getElements('input[name="'+c.getProperty("name")+'"]');b.each(function(e){e.addEvent("blur",function(){if(!a.fxRunning&&(c.element||d.display.showErrors==1)&&(d.display.checkValueIfEmpty||c.value)){a.manageError(c,"click")}})})}}},addListener:function(b){var a=this;b.errors=[];if(b.validation[0]=="submit"){return b.addEvent("click",function(c){if(a.onSubmit(c)){a.form.submit()}})}return a.checkChild(b)},manageError:function(b,e){var a=this,c=a.options;var d=a.validate(b);if(e=="testonly"){return d}if((!d&&b.validation.contains("required"))||(b.value&&!d)||(!d&&b.validation.contains("%almostOne"))){if(c.display.listErrorsAtTop&&e=="submit"){a.listErrorsAtTop(b)}if(c.display.indicateErrors==2||a.alreadyIndicated==false||b==a.alreadyIndicated){if(!a.firstError){a.firstError=b}a.alreadyIndicated=b;if(c.display.keepFocusOnError&&b==a.firstError){(function(){b.focus()}).delay(10)}a.addError(b);return false}}else{if((d||(!b.validation.contains("required")&&!b.value))){a.removeError(b);return true}}return true},validate:function(el){var own=this,opts=own.options;el.errors=[];el.isOk=true;if(opts.trimValue&&el.value.length>0){el.value=el.value.trim()}if((!opts.validateDisabled&&el.get("disabled"))||(!el.validation.contains("required")&&!el.value&&!el.validation.contains("%almostOne"))){return true}el.validation.each(function(rule){if(el.isChild){if(!own.validateGroup(el)){el.isOk=false}}else{var ruleArgs=[];if(rule.match(/target:.+/)){return}var ruleMethod=rule;if(rule.match(/^.+\[/)){ruleMethod=rule.split("[")[0];ruleArgs=eval(rule.match(/^.+(\[.+\])$/)[1].replace(/([A-Z0-9\._-]+)/i,"'$1'"))}if(own.regex.contains(ruleMethod)&&el.get("tag")!="select"){if(own.validateRegex(el,ruleMethod,ruleArgs)==false){el.isOk=false}}if(rule.match(/confirm:.+/)){ruleArgs=[rule.match(/.+:(.+)$/)[1]];if(own.validateConfirm(el,ruleArgs)==false){el.isOk=false}}if(rule.match(/differs:.+/)){ruleArgs=[rule.match(/.+:(.+)$/)[1]];if(own.validateDiffers(el,ruleArgs)==false){el.isOk=false}}if(ruleMethod=="words"){if(own.validateWords(el,ruleArgs)==false){el.isOk=false}}if(ruleMethod=="required"&&(el.get("tag")=="select"||el.type=="checkbox")){if(own.simpleValidate(el)==false){el.isOk=false}}if(rule.match(/%[A-Z0-9\._-]+$/i)||(el.isOk&&rule.match(/~[A-Z0-9\._-]+$/i))){if(eval(rule.slice(1)+"(el)")==false){el.isOk=false}}}});return(el.isOk)?true:false},simpleValidate:function(b){var c=this.Locale.alerts;if(b.get("tag")=="select"){if(!b.multiple){if(b.selectedIndex<=0){b.errors.push(c.select);return false}}else{var a=false;b.getChildren("option").each(function(d){if(d.selected){a=true}});if(!a){b.errors.push(c.select_multiple);return false}}}else{if(b.type=="checkbox"&&b.checked==false){b.errors.push(c.checkbox);return false}}return true},validateRegex:function(c,b,e){var d=this.options;var g=this.Locale.alerts;var f="";if(b=="length"&&e[1]){if(e[1]==-1){d.regexp.length=new RegExp("^[\\s\\S]{"+e[0]+",}$");f=g.lengthmin.replace("%0",e[0])}else{if(e[0]==e[1]){d.regexp.length=new RegExp("^[\\s\\S]{"+e[0]+"}$");f=g.length_fix.replace("%0",e[0])}else{d.regexp.length=new RegExp("^[\\s\\S]{"+e[0]+","+e[1]+"}$");f=g.length_str.replace("%0",e[0]).replace("%1",e[1])}}}else{if(e[0]&&b=="length"){d.regexp.length=new RegExp("^.{0,"+e[0]+"}$");f=g.lengthmax.replace("%0",e[0])}else{f=g[b]}}if((b=="digit"||b=="number")&&e[1]){var h,a=true;if(!d.regexp[b].test(c.value)){c.errors.push(g[b]);a=false}if(e[1]==-1){h=(c.value.toFloat()>=e[0].toFloat());f=g.digitmin.replace("%0",e[0])}else{h=(c.value.toFloat()>=e[0].toFloat()&&c.value.toFloat()<=e[1].toFloat());f=g.digitltd.replace("%0",e[0]).replace("%1",e[1])}if(a==false||h==false){c.errors.push(f);return false}}else{if(d.regexp[b].test(c.value)==false){c.errors.push(f);return false}}return true},validateConfirm:function(b,c){var e=this.Locale.alerts;var a=c[0];if(b.value!=this.form[a].value){var d=(this.options.display.titlesInsteadNames)?e.confirm.replace("%0",this.form[a].getProperty("title")):e.confirm.replace("%0",a);b.errors.push(d);return false}return true},validateDiffers:function(a,c){var e=this.Locale.alerts;var b=c[0];if(a.value==this.form[b].value){var d=(this.options.display.titlesInsteadNames)?e.differs.replace("%0",this.form[b].getProperty("title")):e.differs.replace("%0",b);a.errors.push(d);return false}return true},validateWords:function(c,d){var f=this.Locale.alerts;var b=d[0];var a=d[1];var e=c.value.replace(/[ \t\v\n\r\f\p]/m," ").replace(/[,.;:]/g," ").clean().split(" ");if(a==-1){if(e.length<b){c.errors.push(f.words_min.replace("%0",b).replace("%1",e.length));return false}}else{if(b>0){if(e.length<b||e.length>a){c.errors.push(f.words_range.replace("%0",b).replace("%1",a).replace("%2",e.length));return false}}else{if(e.length>a){c.errors.push(f.words_max.replace("%0",a).replace("%1",e.length));return false}}}return true},isFormValid:function(){var a=this;a.form.isValid=true;a.validations.each(function(c){var b=a.manageError(c,"testonly");if(!b){a.form.isValid=false}});return a.form.isValid},isChildType:function(el,validators){var validator;if($defined(el.type)&&el.type=="radio"){return true}else{if((validator=validators.join().match(/group(\[.*\])/))){var group=eval(validator[1]);this.groups[group[0]]=this.groups[group[0]]||[];this.groups[group[0]][0]=this.groups[group[0]][0]||[];this.groups[group[0]][1]=group[1]||this.groups[group[0]][1]||1;this.groups[group[0]][0].push(el);el.groupID=group[0];return true}}return false},validateGroup:function(d){var f=this.Locale.alerts;d.errors=[];if(d.type=="radio"){var a=this.form[d.getProperty("name")];d.group=a;var c=false;for(var b=0;b<a.length;b++){if(a[b].checked){c=true}}if(c==false){d.errors.push(f.radios);return false}else{return true}}else{if(d.type=="checkbox"){var e=0;this.groups[d.groupID][0].each(function(g){if(g.checked){e++}});if(e>=this.groups[d.groupID][1]){return true}else{(this.groups[d.groupID][0].length>1)?d.errors.push(f.checkboxes_group.replace("%0",this.groups[d.groupID][1])):d.errors.push(f.checkbox);return false}}else{return false}}},listErrorsAtTop:function(a){if(!this.form.element){this.form.element=new Element("div",{id:"errorlist","class":this.options.errorClass}).inject(this.form,"top")}if($type(a)=="collection"){new Element("p").set("html","<span>"+a[0].name+" : </span>"+a[0].errors[0]).inject(this.form.element)}else{if((a.validation.contains("required")&&a.errors.length>0)||(a.errors.length>0&&a.value&&a.validation.contains("required")==false)){a.errors.each(function(b){new Element("p").set("html","<span>"+a.name+" : </span>"+b).inject(this.form.element)},this)}}window.fireEvent("resize")},addError:function(e){var b=this,d=b.options;var h=e.target?$(e.target).getCoordinates():e.getCoordinates();if(!e.element&&d.display.indicateErrors!=0){if(d.display.errorsLocation==1){var g=(d.display.tipsPosition=="left")?h.left:h.right;var c={opacity:0,position:"absolute","float":"left",left:g+d.display.tipsOffsetX};e.element=new Element("div",{"class":d.tipsClass,styles:c}).inject(document.body);b.addPositionEvent(e)}else{if(d.display.errorsLocation==2){e.element=new Element("div",{"class":d.errorClass,styles:{opacity:0}}).inject(e,"before")}else{if(d.display.errorsLocation==3){e.element=new Element("div",{"class":d.errorClass,styles:{opacity:0}});if($type(e.group)=="object"||$type(e.group)=="collection"){e.element.inject(e.group[e.group.length-1],"after")}else{e.element.inject(e,"after")}}}}}if(e.element&&e.element!=true){e.element.empty();if(d.display.errorsLocation==1){var f=[];e.errors.each(function(i){f.push(new Element("p").set("html",i))});var a=this.UI.makeTips(f).inject(e.element);if(d.display.closeTipsButton){a.getElements("a.close").addEvent("mouseup",function(){b.removeError(e,"tip")})}e.element.setStyle("top",h.top-a.getCoordinates().height+d.display.tipsOffsetY)}else{e.errors.each(function(i){new Element("p").set("html",i).inject(e.element)})}if(!d.display.fadeDuration||Browser.Engine.trident&&Browser.Engine.version==5&&d.display.errorsLocation<2){e.element.setStyle("opacity",1)}else{e.fx=new Fx.Tween(e.element,{duration:d.display.fadeDuration,ignore:true,onStart:function(){b.fxRunning=true},onComplete:function(){b.fxRunning=false;if(e.element&&e.element.getStyle("opacity").toInt()==0){e.element.destroy();e.element=false}}});if(e.element.getStyle("opacity").toInt()!=1){e.fx.start("opacity",1)}}}if(d.display.addClassErrorToField&&!e.isChild){e.addClass(d.fieldErrorClass);e.element=e.element||true}},addPositionEvent:function(b){var a=this.options;if(a.display.replaceTipsEffect){b.event=function(){var c=b.target?$(b.target).getCoordinates():b.getCoordinates();new Fx.Morph(b.element,{duration:a.display.fadeDuration}).start({left:[b.element.getStyle("left"),c.right+a.display.tipsOffsetX],top:[b.element.getStyle("top"),c.top-b.element.getCoordinates().height+a.display.tipsOffsetY]})}}else{b.event=function(){var c=b.target?$(b.target).getCoordinates():b.getCoordinates();b.element.setStyles({left:c.right+a.display.tipsOffsetX,top:c.top-b.element.getCoordinates().height+a.display.tipsOffsetY})}}window.addEvent("resize",b.event)},removeError:function(c,d){var a=this;var b=a.options;if((b.display.addClassErrorToField&&!c.isChild&&b.display.removeClassErrorOnTipClosure)||(b.display.addClassErrorToField&&!c.isChild&&!b.display.removeClassErrorOnTipClosure&&d!="tip")){c.removeClass(b.fieldErrorClass)}if(!c.element){return}a.alreadyIndicated=false;c.errors=[];c.isOK=true;window.removeEvent("resize",c.event);if(b.display.errorsLocation>=2&&c.element){new Fx.Tween(c.element,{duration:b.display.fadeDuration}).start("height",0)}if(!b.display.fadeDuration||Browser.Engine.trident&&Browser.Engine.version==5&&b.display.errorsLocation==1&&c.element){a.fxRunning=true;c.element.destroy();c.element=false;(function(){a.fxRunning=false}).delay(200)}else{if(c.element&&c.element!=true){c.fx.start("opacity",0)}}},focusOnError:function(d){var a=this,c=a.options;if(c.display.scrollToFirst&&!a.alreadyFocused&&!a.isScrolling){var e=d.element&&d.element.getCoordinates().top;var b={1:e,2:e-30,3:d.getCoordinates().top-30};b=(c.display.indicateErrors)&&b[c.display.errorsLocation||3]||b[3];if(window.getScroll().y!=b){new Fx.Scroll(window,{onStart:function(){a.isScrolling=true},onComplete:function(){a.isScrolling=false;if(d.getProperty("type")!="hidden"){d.focus()}}}).start(0,b)}else{a.isScrolling=false;d.focus()}a.alreadyFocused=true}},reinitialize:function(b){var a=this;a.validations.each(function(c){if(c.element){c.errors=[];c.isOK=true;if(a.options.display.flashTips==1||b=="forced"){c.element.destroy();c.element=false}}});if(a.form.element){a.form.element.empty()}a.alreadyFocused=false;a.firstError=false;a.elementToRemove=a.alreadyIndicated;a.alreadyIndicated=false;a.form.isValid=true},ajaxSubmit:function(a){Request[this.options.ajaxSubmit]?new Request[this.options.ajaxSubmit](a).send():new Request(a).send();return false},ajaxOptions:function(){var a=$merge({url:this.form.action,method:this.form.method,data:this.form.toQueryString()},this.options.ajaxOptions);return a},onSubmit:function(){var a=this;var b=a.options;a.reinitialize();a.fireEvent("onSubmit");a.validations.each(function(d){var c=a.manageError(d,"submit");if(!c){a.form.isValid=false}});if(a.form.isValid){a.fireEvent("validateSuccess");return(b.ajaxSubmit)?a.ajaxSubmit(a.ajaxOptions()):b.submit}else{if(a.elementToRemove&&a.elementToRemove!=a.firstError&&b.display.indicateErrors==1){a.removeError(a.elementToRemove)}a.focusOnError(a.firstError);a.fireEvent("validateFailure");return false}}});FormCheck.UI=new Class({Implements:[Options,Events],Binds:["hideHint"],options:{extendAlerts:$empty,hintClass:"fc-hint",hints:{enabled:false,method:"click",button:false,useTips:true,titles:false,tipOffset:{x:-45,y:0},buttonOffset:{x:0,y:0},tips:{}}},initialize:function(b,a){this.parent=b;this.setOptions(a);document.addEvent("mousewheel",function(){b.isScrolling=false})},makeTips:function(f){var j=new Element("div",{"class":"fc-tbx"});var o=new Element("div",{"class":"tl"});var h=new Element("div",{"class":"tr"});var n=new Element("div",{"class":"t"});var e=new Element("div",{"class":"l"});var m=new Element("a",{"class":"close"});var a=new Element("div",{"class":"r"});var g=new Element("div",{"class":"c"});f.each(function(b){b.inject(g)});var d=new Element("div",{"class":"bl"});var k=new Element("div",{"class":"br"});var i=new Element("div",{"class":"b"});return j.adopt(o.adopt(h.adopt(n)),e.adopt(m,a.adopt(g)),d.adopt(k.adopt(i)))},addHints:function(){if(this.options.hints.enabled){if(this.options.hints.button===true){this.options.hints.button="after"}if(this.options.hints.method===true){this.options.hints.method=this.options.hints.button?"mouseover":"click"}if(this.options.hints.useTips===true){this.options.hints.useTips="before"}if(this.parent.Locale.localeSet){this.parent.form.getElements("*[title*]").each(function(a){if(a.oTitle){a.set("title",a.oTitle);a.hint=null}})}this.parent.form.getElements("*[title*=hint]").each(function(a){this.makeHints(a)},this)}},makeHints:function(el){var hint=$try(function(){var c=eval(el.getProperty("title").match(/hint(\[.+\])/)[1]);return c==""?el.get("id"):c},function(){return el.get("id")});el.oTitle=el.getProperty("title");el.setProperty("title",el.getProperty("title").replace(/\s?hint(\[.+\])/,"").trim());el.hint=this.parent.Locale.hints[hint];if(!el.hint||el.hint==""){return}this.options.hints.button?this.makeHintButton(el):this.hintEvents(el,el)},hintEvents:function(b,c){var a=this.hideHint.bind(this);if(this.options.hints.method){c.addEvent(this.options.hints.method,function(){this.showHint(b,c)}.bind(this));this.parent.addEvent("onSubmit",a)}else{c.setProperty("title",b.hint)}},removeHintEvents:function(){this.HintEvent.removeEvents({blur:this.boundhideHint,mouseout:this.boundhideHint})},makeHintButton:function(a){if(a.hintBtn){a.hintBtn.dispose()}a.hintBtn=new Element("div",{"class":this.options.hintClass+"-button",styles:{"margin-left":this.options.hints.buttonOffset.x+"px","margin-top":this.options.hints.buttonOffset.y+"px"}}).inject(a,this.options.hints.button);this.hintEvents(a,a.hintBtn)},createHintTip:function(){this.hintTip=new Element("div",{"class":this.options.hintClass}).set("opacity",0);return this.hintTip.adopt(new Element("div",{"class":"title"}),new Element("div",{"class":"content"}))},showHint:function(a){if(!this.hintTip){this.createHintTip();return this.showHint(a)}else{if(this.hintTip.isShown&&this.hintTip.el!=a){this.removeHintEvents();this.hintTip.isShown=false;this.hintTip.fade("hide");return this.showHint(a)}else{return this.drawHint(a).fade("in")}}},drawHint:function(c){this.boundhideHint=this.hideHint.bind(this);if(this.options.hints.method=="mouseover"){this.HintEvent=c.hintBtn||c;this.HintEvent.addEvent("mouseout",this.boundhideHint)}else{this.HintEvent=c;c.focus();this.HintEvent.addEvent("blur",this.boundhideHint)}var a=c||c.hintBtn;var b=this.parent.options.display.titlesInsteadNames?c.title:c.get("name");if(this.options.hints.titles){this.hintTip.getElements("div.title").set("text",b)}this.hintTip.getElements("div.content").set("html",c.hint);this.hintTip.inject(a,this.options.hints.useTips);this.hintTip.el=a;this.hintTip.isShown=true;this.BoundpositionHint=this.positionHint.bind(this);window.addEvent("resize",this.BoundpositionHint);return this.positionHint()},positionHint:function(){if(!this.hintTip.el){return false}var c=this.hintTip.el.getCoordinates();var a=this.hintTip.getCoordinates();var b={before:c.top-a.height,after:c.bottom};return this.hintTip.setStyles({top:b[this.options.hints.useTips]-this.options.hints.tipOffset.y,left:c.right+this.options.hints.tipOffset.x})},hideHint:function(){if(this.hintTip){window.removeEvent("resize",this.BoundpositionHint);this.removeHintEvents();this.hintTip.isShown=false;this.hintTip.fade("out")}}});FormCheck.Locale=new Class({Implements:[Options,Events],data:{},options:{locale:{url:"formcheck/lang","default":"en-EN",language:false,cascade:true}},initialize:function(b,a){this.parent=b;this.setOptions(a);if(!this.options.locale.language){this.options.locale.language=(navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage||this.options.locale["default"])}this.startLocale()},startLocale:function(){var d=this.options.locale.language.toString().split("-",2);var a=d[0];var c=d[1].toUpperCase();this.options.locale.language=a+"-"+c;var b=a+"-"+c;this.getLocale(b)},getLocale:function(b){if(this.localeSet&&!this.isLoading){this.alerts={},this.data={},this.hints={},this.isLoading=true}var a=this.options.locale.url+"/"+b+".json";if(!Request.JSON){return this.setLocale()}return new Request.JSON({url:a,noCache:false,secure:true,onSuccess:function(d){if(!this.data[b]){this.data[b]={}}if($chk(d)){if(d.definitions){this.data[b]=d.definitions}if(d.hints){this.data[b].hints=d.hints}if(d.cascade&&this.options.locale.cascade&&!this.isCascading){var c=d.cascade;if($type(d.cascade)=="array"){if(d.cascade.length>1){this.data[b].cascades=c;this.isCascading=b}c=d.cascade[0]}return this.getLocale(c)}if(this.isCascading){this.data[this.isCascading].cascades.erase(b);if((c=this.data[this.isCascading].cascades[0])){return this.getLocale(c)}this.isCascading=null}}return this.setLocale()}.bind(this),onFailure:function(){var f=(b==this.options.locale["default"]);if(this.options.locale.cascade){if(this.isCascading){this.data[this.isCascading].cascades.erase(b);if((c=this.data[this.isCascading].cascades[0])){return this.getLocale(c)}b=this.isCascading;this.isCascading=null}if(f){return this.setLocale()}var h=b.toString().split("-",2);var e=h[0];var g=h[0].toUpperCase();var d=e+"-"+g;var c=(b!=d&&!f)?d:this.options.locale["default"];return this.getLocale(c)}return this.setLocale()}.bind(this)}).get()},setLocale:function(){var a={};$each(this.data,function(c,b){a=$merge(c,a);a.cascades=null;delete a.cascades});if(a.hints&&this.parent.UI){this.hints=$merge(this.parent.UI.options.hints.tips,a.hints);this.parent.UI.addHints()}this.localeSet=true,this.isLoading=false;return this.alerts=$merge(this.options.alerts,a)}});